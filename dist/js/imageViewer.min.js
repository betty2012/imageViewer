!function(t,i){"use strict";var n=t.imageViewer=function(t,i){this._initialize(t,i),this._initMode(),this._support?(this._initContainer(),this._init()):this.onError("not support")};n.prototype={_initialize:function(t,i){var t=this._container=COM.$D.byID(t);this._clientWidth=t.clientWidth,this._clientHeight=t.clientHeight,this._img=new Image,this._style={},this._x=this._y=1,this._radian=0,this._support=!1,this._init=this._load=this._show=this._dispose=COM.$O.noop;var n=this._setOptions(i);this._zoom=n.zoom,this.onPreLoad=n.onPreLoad,this.onLoad=n.onLoad,this.onError=n.onError,this._LOAD=COM.$F.bind(function(){this.onLoad(),this._load(),this.reset(),this._img.style.visibility="visible"},this),COM.$CE.fireEvent(this,"init")},_setOptions:function(t){return this.options={mode:"css3|filter|canvas",zoom:.1,onPreLoad:function(){},onLoad:function(){},onError:function(t){}},COM.$O.extend(this.options,t||{})},_initMode:function(){var t=n.modes;this._support=COM.$A.some(this.options.mode.toLowerCase().split("|"),function(i){return i=t[i],i&&i.support?(i.init&&(this._init=i.init),i.load&&(this._load=i.load),i.show&&(this._show=i.show),i.dispose&&(this._dispose=i.dispose),COM.$A.forEach(n.transforms,function(t,i){this[i]=function(){t.apply(this,[].slice.call(arguments)),this._show()}},this),!0):void 0},this)},_initContainer:function(){var t=this._container,i=t.style,n=COM.$D.getStyle(t,"position");this._style={position:i.position,overflow:i.overflow},"relative"!=n&&"absolute"!=n&&(i.position="relative"),i.overflow="hidden",COM.$CE.fireEvent(this,"initContainer")},load:function(t){if(this._support){var i=this._img,n=this;i.onload||(i.onload=this._LOAD),i.onerror||(i.onerror=function(){n.onError("err image")}),i.style.visibility="hidden",this.onPreLoad(),i.src=t}},reset:function(){this._support&&(this._x=this._y=1,this._radian=0,this._show())},dispose:function(){this._support&&(this._dispose(),COM.$CE.fireEvent(this,"dispose"),COM.$D.setStyle(this._container,this._style),this._container=this._img=this._img.onload=this._img.onerror=this._LOAD=null)}},n.modes=function(){function t(t,i){COM.$D.setStyle(t,{position:"absolute",border:0,padding:0,margin:0,width:"auto",height:"auto",visibility:"hidden"}),i.appendChild(t)}function i(t,i,n){var e=Math.cos(t),s=Math.sin(t);return{M11:e*i,M12:-s*n,M21:s*i,M22:e*n}}var n;return{css3:{support:function(){var t=document.createElement("div").style;return COM.$A.some(["transform","MozTransform","webkitTransform","OTransform"],function(i){return i in t?(n=i,!0):void 0})}(),init:function(){t(this._img,this._container)},load:function(){var t=this._img;COM.$D.setStyle(t,{top:(this._clientHeight-t.offsetHeight)/2+"px",left:(this._clientWidth-t.offsetWidth)/2+"px",visibility:"visible"})},show:function(){var t=i(this._radian,this._y,this._x);this._img.style[n]="matrix("+t.M11.toFixed(16)+","+t.M21.toFixed(16)+","+t.M12.toFixed(16)+","+t.M22.toFixed(16)+", 0, 0)"},dispose:function(){this._container.removeChild(this._img)}},filter:{support:function(){return"filters"in document.createElement("div")}(),init:function(){t(this._img,this._container),this._img.style.filter="progid:DXimageViewerform.Microsoft.Matrix(SizingMethod='auto expand')"},load:function(){this._img.onload=null,this._img.style.visibility="visible"},show:function(){var t=this._img;COM.$.extend(t.filters.item("DXimageViewerform.Microsoft.Matrix"),i(this._radian,this._y,this._x)),t.style.top=(this._clientHeight-t.offsetHeight)/2+"px",t.style.left=(this._clientWidth-t.offsetWidth)/2+"px"},dispose:function(){this._container.removeChild(this._img)}},canvas:{support:function(){return"getContext"in document.createElement("canvas")}(),init:function(){var t=this._canvas=document.createElement("canvas");this._context=t.getContext("2d");COM.$D.setStyle(t,{position:"absolute",left:0,top:0}),t.width=this._clientWidth,t.height=this._clientHeight,this._container.appendChild(t)},show:function(){var t=this._img,i=this._context,n=this._clientWidth,e=this._clientHeight;i.save(),i.clearRect(0,0,n,e),i.translate(n/2,e/2),i.rotate(this._radian),i.scale(this._y,this._x),i.drawImage(t,-t.width/2,-t.height/2),i.restore()},dispose:function(){this._container.removeChild(this._canvas),this._canvas=this._context=null}}}}(),n.transforms={vertical:function(){this._radian=Math.PI-this._radian,this._y*=-1},horizontal:function(){this._radian=Math.PI-this._radian,this._x*=-1},rotate:function(t){this._radian=t},left:function(){this._radian-=Math.PI/2},right:function(){this._radian+=Math.PI/2},rotateByDegress:function(t){this._radian=t*Math.PI/180},scale:function(){function t(t,i){return t>0&&t>-i?i:0>t&&i>t?-i:0}return function(i){if(i){var n=t(this._y,i),e=t(this._x,i);n&&e&&(this._y+=n,this._x+=e)}}}(),zoomin:function(){this.scale(Math.abs(this._zoom))},zoomout:function(){this.scale(-Math.abs(this._zoom))}},n.prototype._initialize=function(){function i(i){var n=this._container,e="number"==typeof i.button;if(e&&1===i.button){var s=COM.$D.clientRect(this._container);this._mrX=s.left+this._clientWidth/2,this._mrY=s.top+this._clientHeight/2,this._mrRadian=Math.atan2(i.clientY-this._mrY,i.clientX-this._mrX)-this._radian}else e&&0===i.button&&(this._mrX=i.clientX,this._mrY=i.clientY,h=parseInt(this._img.style.top),a=parseInt(this._img.style.left));COM.$E.addEvent(document,"mousemove",this._mrMOVE),COM.$E.addEvent(document,"mouseup",this._mrSTOP),COM.$B.browser.ie?(COM.$E.addEvent(n,"losecapture",this._mrSTOP),n.setCapture()):(COM.$E.addEvent(t,"blur",this._mrSTOP),i.preventDefault())}function e(i){var n="number"==typeof i.button;if(n&&1===i.button)this.rotate(Math.atan2(i.clientY-this._mrY,i.clientX-this._mrX)-this._mrRadian);else if(n&&0===i.button){var e=parseInt(i.clientY-this._mrY),s=parseInt(i.clientX-this._mrX);this._img.style.top=h+e+"px",this._img.style.left=a+s+"px"}t.getSelection?t.getSelection().removeAllRanges():document.selection.empty()}function s(){if(COM.$E.removeEvent(document,"mousemove",this._mrMOVE),COM.$E.removeEvent(document,"mouseup",this._mrSTOP),COM.$B.browser.ie){var i=this._container;COM.$E.removeEvent(i,"losecapture",this._mrSTOP),i.releaseCapture()}else COM.$E.removeEvent(t,"blur",this._mrSTOP)}var o=n.prototype._initialize,r={init:function(){this._mrX=this._mrY=this._mrRadian=0,this._mrSTART=COM.$F.bind(i,this),this._mrMOVE=COM.$F.bind(e,this),this._mrSTOP=COM.$F.bind(s,this)},initContainer:function(){COM.$E.addEvent(this._container,"mousedown",this._mrSTART)},dispose:function(){COM.$E.removeEvent(this._container,"mousedown",this._mrSTART),this._mrSTOP(),this._mrSTART=this._mrMOVE=this._mrSTOP=null}},h=0,a=0;return function(){var t=arguments[1];t&&t.mouseRotate===!1||COM.$A.forEach(r,function(t,i){COM.$CE.addEvent(this,i,t)},this),o.apply(this,arguments)}}(),n.prototype._initialize=function(){function t(t){this.scale((t.wheelDelta?t.wheelDelta/-120:(t.detail||0)/3)*Math.abs(this._zoom)),t.preventDefault()}var i=n.prototype._initialize,e=COM.$B.browser.firefox?"DOMMouseScroll":"mousewheel",s={init:function(){this._mzZoom=COM.$F.bind(t,this)},initContainer:function(){COM.$E.addEvent(this._container,e,this._mzZoom)},dispose:function(){COM.$E.removeEvent(this._container,e,this._mzZoom),this._mzZoom=null}};return function(){var t=arguments[1];t&&t.mouseZoom===!1||COM.$A.forEach(s,function(t,i){COM.$CE.addEvent(this,i,t)},this),i.apply(this,arguments)}}(),"function"==typeof define&&define([],function(){return n})}(window);